# Readme

This folder contains ShapeChange configuration files for effectuating UML to OWL transformations

ShapeChange documentation and installation instructions can be found [here](https://shapechange.net/get-started/)

Currently there are 4 configuration files:
1. CityGML 3.0 to OWL: `CityGML3.0_to_OWL_config.xml`
2. CityGML 2.0 to OWL: `CityGML2.0_to_OWL_config.xml`
3. Enterprise Architect to ShapeChange XML: `EA_to_SCXML_config.xml`
4. CityGML 2.0 ADE to XML Schema: `CityGML2.0_to_XSD_config.xml`

Additionally the `StandardMapEntries_iso19107-owl.xml` file contains mappings between the abstract geometric UML classes from ISO 19107 and the [GML ontology](https://schemas.opengis.net/gml/3.2.1/gml_32_geometries.rdf) (adapted from [the mappings proposed by ShapeChange](https://shapechange.net/resources/config/StandardMapEntries_iso19107-owl.xml))


A tool for patching OWL ontologies created using ShapeChange and these configurations is provided: `ontologyPatcher.py`
Currently 3 types of patches are targeted:
1. Class restrictions that use the property owl:onClass with the object of an rdfs:Datatype are converted to owl:onDataRange.
2. Datatype definitions created from enumerations that use owl:oneOf are redefined to use a Protégé friendly owl:equvalentClass axiom 
containing the owl:oneOf property.
3. ObjectProperty definitions which contain an rdfs:Datatype within their range are redefined as DatatypeProperties.

These patches help ensure the generated ontologies are in OWL-DL and not just OWL Full (to enable reasoning). Patch 3 may be specific to Protégé or just the Turtle RDF format.

## To run shapechange
Use the following command to run ShapeChange with the configuration files. Be sure to update the variables in '[]' brackets with their desired values.
```bash
java -jar [path to ShapeChange jar] -Dfile.encoding=UTF-8 -c [CONFIGURATION FILE] -x '$input$' '[UML FILE]' -x '$output$' '[OUTPUT FOLDER]'
```

Example for with a ShapeChange JAR file, `../lib/ShapeChange-2.11.0.jar`:
```bash
java -jar ../lib/ShapeChange-2.11.0.jar -Dfile.encoding=UTF-8 -c CityGML3.0_config.xml \
  -x '$input$' './test-data/UML/CityGML_3.0-workspaces-documents_shapechange-export.xml' \
  -x '$output$' './test-data/OWL/CityGML_3.0_Conceptual_Model'
```


## To run the ontology patcher
```
usage: ontologyPatcher.py [-h] [--input_format INPUT_FORMAT] [--output_format OUTPUT_FORMAT] [--log LOG] input_file output_file

positional arguments:
  input_file            Specify the input file
  output_file           Specify the output file

optional arguments:
  -h, --help            show this help message and exit
  --input_format INPUT_FORMAT
                        Specify the RDFLib compliant input file format
  --output_format OUTPUT_FORMAT
                        Specify the RDFLib compliant output file format
  --log LOG, -l LOG     Specify the logging file
```

For example to patch the CityGML 3.0 ontologies generated by the shapechange transformation example above:
```bash
mkdir ./3.0
python ontologyPatcher.py ../test-data/OWL/CityGML_3.0_Conceptual_Model/FLATTENER1/appearance/appearance.ttl ./3.0/appearance.ttl
python ontologyPatcher.py ../test-data/OWL/CityGML_3.0_Conceptual_Model/FLATTENER1/bridge/bridge.ttl ./3.0/bridge.ttl
python ontologyPatcher.py ../test-data/OWL/CityGML_3.0_Conceptual_Model/FLATTENER1/building/building.ttl ./3.0/building.ttl
python ontologyPatcher.py ../test-data/OWL/CityGML_3.0_Conceptual_Model/FLATTENER1/cityfurniture/cityfurniture.ttl ./3.0/cityfurniture.ttl
python ontologyPatcher.py ../test-data/OWL/CityGML_3.0_Conceptual_Model/FLATTENER1/cityobjectgroup/cityobjectgroup.ttl ./3.0/cityobjectgroup.ttl
python ontologyPatcher.py ../test-data/OWL/CityGML_3.0_Conceptual_Model/FLATTENER1/construction/construction.ttl ./3.0/construction.ttl
python ontologyPatcher.py ../test-data/OWL/CityGML_3.0_Conceptual_Model/FLATTENER1/core/core.ttl ./3.0/core.ttl
python ontologyPatcher.py ../test-data/OWL/CityGML_3.0_Conceptual_Model/FLATTENER1/dynamizer/dynamizer.ttl ./3.0/dynamizer.ttl
python ontologyPatcher.py ../test-data/OWL/CityGML_3.0_Conceptual_Model/FLATTENER1/generics/generics.ttl ./3.0/generics.ttl
python ontologyPatcher.py ../test-data/OWL/CityGML_3.0_Conceptual_Model/FLATTENER1/landuse/landuse.ttl ./3.0/landuse.ttl
python ontologyPatcher.py ../test-data/OWL/CityGML_3.0_Conceptual_Model/FLATTENER1/pointcloud/pointcloud.ttl ./3.0/pointcloud.ttl
python ontologyPatcher.py ../test-data/OWL/CityGML_3.0_Conceptual_Model/FLATTENER1/relief/relief.ttl ./3.0/relief.ttl
python ontologyPatcher.py ../test-data/OWL/CityGML_3.0_Conceptual_Model/FLATTENER1/transportation/transportation.ttl ./3.0/transportation.ttl
python ontologyPatcher.py ../test-data/OWL/CityGML_3.0_Conceptual_Model/FLATTENER1/tunnel/tunnel.ttl ./3.0/tunnel.ttl
python ontologyPatcher.py ../test-data/OWL/CityGML_3.0_Conceptual_Model/FLATTENER1/vegetation/vegetation.ttl ./3.0/vegetation.ttl
python ontologyPatcher.py ../test-data/OWL/CityGML_3.0_Conceptual_Model/FLATTENER1/versioning/versioning.ttl ./3.0/versioning.ttl
python ontologyPatcher.py ../test-data/OWL/CityGML_3.0_Conceptual_Model/FLATTENER1/waterbody/waterbody.ttl ./3.0/waterbody.ttl
python ontologyPatcher.py ../test-data/OWL/CityGML_3.0_Conceptual_Model/FLATTENER1/document/document.ttl ./3.0/document.ttl
python ontologyPatcher.py ../test-data/OWL/CityGML_3.0_Conceptual_Model/FLATTENER1/workspace/workspace.ttl ./3.0/workspace.ttl
```